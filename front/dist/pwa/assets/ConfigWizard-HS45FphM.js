import{_ as U,c as x,o as u,w as d,a as i,Q as _,e as v,b as s,f as n,a1 as h,a6 as c,a7 as a,a8 as g,a9 as V,h as A,aa as C,X as y}from"./index-DmowfgHc.js";import{Q as q,a as w}from"./QSelect-DPrbmaZK.js";import{Q as M,a as E}from"./QTable-CP5uC_4S.js";import{Q}from"./QPage-Dinguz5N.js";import{C as k}from"./ClosePopup-DMX31QLz.js";import"./QResizeObserver-CEsq7uYG.js";import"./QChip-BkIZX7c1.js";import"./QMenu-Cbu48RQv.js";import"./format-BvkBI9bc.js";import"./QList-Dq7i1iLW.js";import"./QMarkupTable-Bb1F7dg5.js";const T={name:"ConfigWizard",data(){return{step:1,saving:!1,profile:{nombre:"",apellidos:"",username:"",fecha_nacimiento:"",genero:null,pais:"",estado_provincia:"",tipo_centro:"",nombre_centro:"",etapa:"",curso:"",clase_letra:"",minutos_descanso:10,minutos_estudio_max:50},diasSemana:[{value:"1",label:"LUN"},{value:"2",label:"MAR"},{value:"3",label:"MIE"},{value:"4",label:"JUE"},{value:"5",label:"VIE"},{value:"6",label:"SAB"},{value:"7",label:"DOM"}],diaActivo:"1",horarios:{},materias:[],materiaForm:{nombre:"",abreviatura:""},columnsMaterias:[{name:"nombre",label:"Materia",field:"nombre",align:"left"},{name:"abreviatura",label:"Abrev.",field:"abreviatura",align:"left"},{name:"acciones",label:"",align:"right"}],dialogDescanso:!1}},created(){this.diasSemana.forEach(t=>{this.horarios[t.value]={habitual:[],extra:[]}}),this.cargarPerfil(),this.cargarHorarios(),this.cargarMaterias()},methods:{cargarPerfil(){this.$axios.get("/profile/me").then(({data:t})=>{this.profile=Object.assign(this.profile,t)}).catch(()=>{})},guardarPerfil(){return this.$axios.post("/profile/save",this.profile)},cargarHorarios(){this.$axios.get("/study-schedules").then(({data:t})=>{t.forEach(e=>{const r=String(e.dia_semana),b=e.tipo==="EXTRA"?"extra":"habitual";this.horarios[r]||(this.horarios[r]={habitual:[],extra:[]}),this.horarios[r][b].push({id:e.id,hora_inicio:e.hora_inicio.slice(0,5),hora_fin:e.hora_fin.slice(0,5)})})}).catch(()=>{})},guardarHorarios(){const t=[];return Object.keys(this.horarios).forEach(e=>{this.horarios[e].habitual.forEach(r=>{t.push({id:r.id,dia_semana:parseInt(e),tipo:"HABITUAL",hora_inicio:r.hora_inicio+":00",hora_fin:r.hora_fin+":00"})}),this.horarios[e].extra.forEach(r=>{t.push({id:r.id,dia_semana:parseInt(e),tipo:"EXTRA",hora_inicio:r.hora_inicio+":00",hora_fin:r.hora_fin+":00"})})}),this.$axios.get("/study-schedules").then(({data:e})=>{const r=e.map(b=>this.$axios.delete(`/study-schedules/${b.id}`));return Promise.all(r).then(()=>{if(t.length!==0)return this.$axios.post("/study-schedules",t)})})},addBloque(t,e){this.horarios[t][e].push({hora_inicio:"00:00",hora_fin:"00:00"})},removeBloque(t,e,r){this.horarios[t][e].splice(r,1)},cargarMaterias(){this.$axios.get("/materias").then(({data:t})=>{this.materias=t}).catch(()=>{})},agregarMateria(){this.materiaForm.nombre&&this.$axios.post("/materias",this.materiaForm).then(({data:t})=>{this.materias.unshift(t),this.materiaForm.nombre="",this.materiaForm.abreviatura=""})},eliminarMateria(t){this.$axios.delete(`/materias/${t}`).then(()=>{this.materias=this.materias.filter(e=>e.id!==t)})},onNext(){this.saving=!0;let t;this.step===1?t=this.guardarPerfil():this.step===2?t=this.guardarHorarios():t=this.$axios.post("/onboarding/complete"),t.then(()=>{this.step<3?this.step++:(this.$q.notify({type:"positive",message:"Configuración completada"}),this.$router.replace("/"))}).finally(()=>{this.saving=!1})}}},B={class:"row justify-center q-mt-md q-gutter-xl"},F={class:"column items-center"},P={class:"column items-center"},S={class:"column items-center"},D={key:0},I={class:"row q-col-gutter-md"},N={class:"col-12 col-md-4"},R={class:"col-12 col-md-4"},O={class:"col-12 col-md-4"},j={class:"col-12 col-md-4"},H={class:"col-12 col-md-4"},L={class:"row q-gutter-sm"},z={class:"col-12 col-md-4"},J={class:"col-12 col-md-4"},X={class:"col-12 col-md-4"},G={class:"col-12 col-md-4"},W={class:"col-12 col-md-4"},K={class:"col-12 col-md-4"},Y={class:"col-12 col-md-4"},Z={key:1},$={class:"col-5 col-md-3"},ee={class:"col-5 col-md-3"},oe={class:"col-auto"},le={class:"col-5 col-md-3"},ie={class:"col-5 col-md-3"},se={class:"col-auto"},te={key:2},ae={class:"row q-col-gutter-md items-end q-mb-md"},re={class:"col-12 col-md-4"},ne={class:"col-12 col-md-4"},de={class:"col-auto"};function ue(t,e,r,b,o,p){return u(),x(Q,{class:"q-pa-md bg-grey-2 flex flex-center"},{default:d(()=>[i(_,{style:{"max-width":"900px",width:"100%"},flat:"",bordered:""},{default:d(()=>[i(v,{class:"text-center"},{default:d(()=>[e[26]||(e[26]=s("div",{class:"text-h6 text-weight-bold"},"Configuración",-1)),e[27]||(e[27]=s("div",{class:"text-caption text-grey-7"}," Tómate unos minutos para configurar tu cuenta correctamente. ",-1)),s("div",B,[s("div",F,[i(n,{round:"",flat:"",color:o.step>=1?"primary":"grey-5",icon:"person"},null,8,["color"]),e[23]||(e[23]=s("div",{class:"text-caption q-mt-xs"},"PERSONAL",-1))]),s("div",P,[i(n,{round:"",flat:"",color:o.step>=2?"primary":"grey-5",icon:"schedule"},null,8,["color"]),e[24]||(e[24]=s("div",{class:"text-caption q-mt-xs"},"TIEMPO ESTUDIO",-1))]),s("div",S,[i(n,{round:"",flat:"",color:o.step>=3?"primary":"grey-5",icon:"menu_book"},null,8,["color"]),e[25]||(e[25]=s("div",{class:"text-caption q-mt-xs"},"ASIGNATURAS",-1))])])]),_:1}),i(h),i(v,null,{default:d(()=>[o.step===1?(u(),c("div",D,[e[29]||(e[29]=s("div",{class:"text-subtitle1 text-weight-bold q-mb-md"},"Información personal",-1)),s("div",I,[s("div",N,[i(a,{modelValue:o.profile.nombre,"onUpdate:modelValue":e[0]||(e[0]=l=>o.profile.nombre=l),label:"Nombre",dense:"",outlined:""},null,8,["modelValue"])]),s("div",R,[i(a,{modelValue:o.profile.apellidos,"onUpdate:modelValue":e[1]||(e[1]=l=>o.profile.apellidos=l),label:"Apellidos",dense:"",outlined:""},null,8,["modelValue"])]),s("div",O,[i(a,{modelValue:o.profile.username,"onUpdate:modelValue":e[2]||(e[2]=l=>o.profile.username=l),label:"Usuario",dense:"",outlined:""},null,8,["modelValue"])]),s("div",j,[i(a,{modelValue:o.profile.fecha_nacimiento,"onUpdate:modelValue":e[3]||(e[3]=l=>o.profile.fecha_nacimiento=l),type:"date",label:"Fecha nacimiento",dense:"",outlined:""},null,8,["modelValue"])]),s("div",H,[e[28]||(e[28]=s("div",{class:"text-caption text-grey-7 q-mb-xs"},"Género",-1)),s("div",L,[i(n,{"no-caps":"",outline:"",class:"col",color:o.profile.genero==="MUJER"?"primary":"grey-6",label:"Mujer",onClick:e[4]||(e[4]=l=>o.profile.genero="MUJER")},null,8,["color"]),i(n,{"no-caps":"",outline:"",class:"col",color:o.profile.genero==="VARON"?"primary":"grey-6",label:"Varón",onClick:e[5]||(e[5]=l=>o.profile.genero="VARON")},null,8,["color"])])]),s("div",z,[i(a,{modelValue:o.profile.pais,"onUpdate:modelValue":e[6]||(e[6]=l=>o.profile.pais=l),label:"País",dense:"",outlined:""},null,8,["modelValue"])]),s("div",J,[i(a,{modelValue:o.profile.estado_provincia,"onUpdate:modelValue":e[7]||(e[7]=l=>o.profile.estado_provincia=l),label:"Estado / Provincia",dense:"",outlined:""},null,8,["modelValue"])]),s("div",X,[i(a,{modelValue:o.profile.tipo_centro,"onUpdate:modelValue":e[8]||(e[8]=l=>o.profile.tipo_centro=l),label:"Tipo centro",dense:"",outlined:""},null,8,["modelValue"])]),s("div",G,[i(a,{modelValue:o.profile.nombre_centro,"onUpdate:modelValue":e[9]||(e[9]=l=>o.profile.nombre_centro=l),label:"Nombre centro",dense:"",outlined:""},null,8,["modelValue"])]),s("div",W,[i(a,{modelValue:o.profile.etapa,"onUpdate:modelValue":e[10]||(e[10]=l=>o.profile.etapa=l),label:"Etapa",dense:"",outlined:""},null,8,["modelValue"])]),s("div",K,[i(a,{modelValue:o.profile.curso,"onUpdate:modelValue":e[11]||(e[11]=l=>o.profile.curso=l),label:"Curso",dense:"",outlined:""},null,8,["modelValue"])]),s("div",Y,[i(a,{modelValue:o.profile.clase_letra,"onUpdate:modelValue":e[12]||(e[12]=l=>o.profile.clase_letra=l),label:"Clase",dense:"",outlined:""},null,8,["modelValue"])])])])):o.step===2?(u(),c("div",Z,[e[32]||(e[32]=s("div",{class:"text-subtitle1 text-weight-bold q-mb-md"},"Tiempo de estudio",-1)),i(q,{modelValue:o.diaActivo,"onUpdate:modelValue":e[13]||(e[13]=l=>o.diaActivo=l),dense:"","active-color":"primary","indicator-color":"primary",align:"justify"},{default:d(()=>[(u(!0),c(g,null,V(o.diasSemana,l=>(u(),x(w,{key:l.value,name:l.value,label:l.label},null,8,["name","label"]))),128))]),_:1},8,["modelValue"]),i(h,{spaced:""}),s("div",null,[e[30]||(e[30]=s("div",{class:"text-caption text-grey-7 q-mb-xs"},"Tiempo habitual",-1)),(u(!0),c(g,null,V(o.horarios[o.diaActivo].habitual,(l,f)=>(u(),c("div",{key:"h-"+f,class:"row items-center q-col-gutter-sm q-mb-xs"},[s("div",$,[i(a,{dense:"",outlined:"",modelValue:l.hora_inicio,"onUpdate:modelValue":m=>l.hora_inicio=m,label:"De",mask:"##:##"},null,8,["modelValue","onUpdate:modelValue"])]),s("div",ee,[i(a,{dense:"",outlined:"",modelValue:l.hora_fin,"onUpdate:modelValue":m=>l.hora_fin=m,label:"A",mask:"##:##"},null,8,["modelValue","onUpdate:modelValue"])]),s("div",oe,[i(n,{dense:"",flat:"",round:"",icon:"remove",color:"negative",onClick:m=>p.removeBloque(o.diaActivo,"habitual",f)},null,8,["onClick"])])]))),128)),i(n,{outline:"",color:"primary",icon:"add",dense:"","no-caps":"",label:"Añadir intervalo",onClick:e[14]||(e[14]=l=>p.addBloque(o.diaActivo,"habitual"))}),i(h,{spaced:""}),e[31]||(e[31]=s("div",{class:"text-caption text-grey-7 q-mb-xs"},"Tiempo extra",-1)),(u(!0),c(g,null,V(o.horarios[o.diaActivo].extra,(l,f)=>(u(),c("div",{key:"e-"+f,class:"row items-center q-col-gutter-sm q-mb-xs"},[s("div",le,[i(a,{dense:"",outlined:"",modelValue:l.hora_inicio,"onUpdate:modelValue":m=>l.hora_inicio=m,label:"De",mask:"##:##"},null,8,["modelValue","onUpdate:modelValue"])]),s("div",ie,[i(a,{dense:"",outlined:"",modelValue:l.hora_fin,"onUpdate:modelValue":m=>l.hora_fin=m,label:"A",mask:"##:##"},null,8,["modelValue","onUpdate:modelValue"])]),s("div",se,[i(n,{dense:"",flat:"",round:"",icon:"remove",color:"negative",onClick:m=>p.removeBloque(o.diaActivo,"extra",f)},null,8,["onClick"])])]))),128)),i(n,{outline:"",color:"primary",icon:"add",dense:"","no-caps":"",label:"Añadir intervalo extra",onClick:e[15]||(e[15]=l=>p.addBloque(o.diaActivo,"extra"))})])])):(u(),c("div",te,[e[34]||(e[34]=s("div",{class:"text-subtitle1 text-weight-bold q-mb-md"},"Asignaturas",-1)),s("div",ae,[s("div",re,[i(a,{modelValue:o.materiaForm.nombre,"onUpdate:modelValue":e[16]||(e[16]=l=>o.materiaForm.nombre=l),label:"Materia",dense:"",outlined:""},null,8,["modelValue"])]),s("div",ne,[i(a,{modelValue:o.materiaForm.abreviatura,"onUpdate:modelValue":e[17]||(e[17]=l=>o.materiaForm.abreviatura=l),label:"Abrev.",dense:"",outlined:""},null,8,["modelValue"])]),s("div",de,[i(n,{color:"primary","no-caps":"",label:"Añadir",onClick:p.agregarMateria},null,8,["onClick"])])]),i(M,{rows:o.materias,columns:o.columnsMaterias,"row-key":"id",flat:"",bordered:"",dense:"","hide-pagination":""},{"body-cell-acciones":d(l=>[i(E,{props:l},{default:d(()=>[i(n,{dense:"",flat:"",round:"",icon:"delete",color:"negative",onClick:f=>p.eliminarMateria(l.row.id)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"]),i(n,{flat:"",color:"primary",class:"q-mt-md","no-caps":"",label:"Configurar descansos",onClick:e[18]||(e[18]=l=>o.dialogDescanso=!0)}),i(A,{modelValue:o.dialogDescanso,"onUpdate:modelValue":e[21]||(e[21]=l=>o.dialogDescanso=l),persistent:""},{default:d(()=>[i(_,{style:{"max-width":"400px"}},{default:d(()=>[i(v,null,{default:d(()=>[...e[33]||(e[33]=[s("div",{class:"text-subtitle1 text-weight-bold"},"Importante",-1),s("div",{class:"text-body2 q-mt-sm"}," ¿Cada cuánto quieres descansar? ",-1),s("div",{class:"text-caption text-grey-7 q-mt-xs"}," Recomendación: 10 minutos cada 50. ",-1)])]),_:1}),i(v,null,{default:d(()=>[i(a,{modelValue:o.profile.minutos_descanso,"onUpdate:modelValue":e[19]||(e[19]=l=>o.profile.minutos_descanso=l),modelModifiers:{number:!0},type:"number",dense:"",outlined:"",label:"Descanso (minutos)"},null,8,["modelValue"]),i(a,{modelValue:o.profile.minutos_estudio_max,"onUpdate:modelValue":e[20]||(e[20]=l=>o.profile.minutos_estudio_max=l),modelModifiers:{number:!0},type:"number",dense:"",outlined:"",label:"Máximo estudio (minutos)",class:"q-mt-sm"},null,8,["modelValue"])]),_:1}),i(C,{align:"right"},{default:d(()=>[y(i(n,{flat:"",label:"Cancelar"},null,512),[[k]]),y(i(n,{color:"primary",label:"Aceptar"},null,512),[[k]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))]),_:1}),i(h),i(v,{class:"row justify-between"},{default:d(()=>[i(n,{flat:"","no-caps":"",label:"Paso anterior",disable:o.step===1,onClick:e[22]||(e[22]=l=>o.step--)},null,8,["disable"]),i(n,{color:"primary","no-caps":"",label:o.step===3?"Finalizar":"Siguiente paso",loading:o.saving,onClick:p.onNext},null,8,["label","loading","onClick"])]),_:1})]),_:1})]),_:1})}const ye=U(T,[["render",ue]]);export{ye as default};
