import{Q as _}from"./QSpace-ConhfHTf.js";import{Q as p}from"./QSelect-CUHZ8A06.js";import{_ as E,c as T,o as m,w as r,a as i,Q as h,b as l,an as d,ar as k,d as N,f as u,am as c,a0 as g,ao as C,ap as Q,$ as f,t as n,h as q,e as b,X as U,at as A,aq as w}from"./index-C2U7cvHx.js";import{Q as M,a as V}from"./QTabs-Dq76__wx.js";import{Q as x}from"./QTooltip-DMwuWmsY.js";import{Q as y}from"./QChip-D-VW4ljL.js";import{Q as D}from"./QMarkupTable-DUP74zwm.js";import{Q as P}from"./QForm-BY2E_j9b.js";import{Q as I}from"./QPage-B4jRUFjQ.js";import{C as F}from"./ClosePopup-Dk5dRHPC.js";import"./format-BvkBI9bc.js";import"./QResizeObserver-CL5VoRlh.js";const O={name:"TareasPage",data(){return{tareas:[],materias:[],filtro:"",filtroMateriaId:null,filtroEstado:null,vista:"general",loading:!1,dialog:!1,form:{id:null,materia_id:null,tipo_tarea:"",descripcion:"",fecha_entrega:"",fecha_creacion:"",estado:"",tiempo_estimado:null,prioridad:"Normal",fecha_planificada:"",hora_inicio_plan:"",hora_fin_plan:"",descanso_duracion:10,descanso_cada:50},tipoTareaOptions:["Normal","Estudio","Examen"],prioridadOptions:["Normal","Alta"],estadoOptions:["PENDIENTE","ENTREGADA","ATRASADA"]}},computed:{materiaOptions(){return(this.materias||[]).map(t=>({id:t.id,label:t.nombre}))},tareasFiltradas(){const t=this.tareas||[];return this.vista==="prioritaria"?t.filter(e=>(e.prioridad||"").toUpperCase()==="ALTA"):t}},mounted(){this.cargarMaterias(),this.listar()},methods:{colorEstado(t){switch((t||"").toUpperCase()){case"ENTREGADA":return"positive";case"ATRASADA":return"negative";case"PENDIENTE":return"warning";default:return"grey-7"}},colorPrioridad(t){return(t||"NORMAL").toUpperCase()==="ALTA"?"deep-orange":"grey-7"},async cargarMaterias(){try{const t=await this.$axios.get("materias");this.materias=(t.data||[]).map(e=>({...e,label:e.nombre}))}catch(t){this.$alert?.error?.(t.response?.data?.message||"Error cargando materias")}},async listar(){this.loading=!0;try{const t={q:this.filtro||void 0,materia_id:this.filtroMateriaId||void 0,estado:this.filtroEstado||void 0},e=await this.$axios.get("tareas",{params:t});this.tareas=e.data}catch(t){this.$alert?.error?.(t.response?.data?.message||"Error al cargar tareas")}finally{this.loading=!1}},nuevo(){this.form={id:null,materia_id:this.filtroMateriaId||null,tipo_tarea:"",descripcion:"",fecha_entrega:"",fecha_creacion:new Date().toISOString().slice(0,10),estado:this.filtroEstado||"PENDIENTE",tiempo_estimado:null,prioridad:"Normal",fecha_planificada:"",hora_inicio_plan:"",hora_fin_plan:"",descanso_duracion:10,descanso_cada:50},this.dialog=!0},editar(t){this.form={id:t.id,materia_id:t.materia_id??t.materia?.id??null,tipo_tarea:t.tipo_tarea||"",descripcion:t.descripcion||"",fecha_entrega:t.fecha_entrega||"",fecha_creacion:t.fecha_creacion||"",estado:t.estado||"PENDIENTE",tiempo_estimado:t.tiempo_estimado??null,prioridad:t.prioridad||"Normal",fecha_planificada:t.fecha_planificada||"",hora_inicio_plan:t.hora_inicio_plan||"",hora_fin_plan:t.hora_fin_plan||"",descanso_duracion:t.descanso_duracion??10,descanso_cada:t.descanso_cada??50},this.dialog=!0},onDialogHide(){this.form={id:null,materia_id:null,tipo_tarea:"",descripcion:"",fecha_entrega:"",fecha_creacion:"",estado:"",tiempo_estimado:null,prioridad:"Normal",fecha_planificada:"",hora_inicio_plan:"",hora_fin_plan:"",descanso_duracion:10,descanso_cada:50}},async guardar(){this.loading=!0;try{this.form.id?(await this.$axios.put(`tareas/${this.form.id}`,this.form),this.$alert?.success?.("Tarea actualizada correctamente")):(await this.$axios.post("tareas",this.form),this.$alert?.success?.("Tarea creada correctamente")),this.dialog=!1,this.listar()}catch(t){this.$alert?.error?.(t.response?.data?.message||"No se pudo guardar la tarea")}finally{this.loading=!1}},eliminar(t){this.$alert?.dialog?.("¿Eliminar esta tarea?")?.onOk(async()=>{this.loading=!0;try{await this.$axios.delete(`tareas/${t}`),this.$alert?.success?.("Tarea eliminada"),this.listar()}catch(e){this.$alert?.error?.(e.response?.data?.message||"No se pudo eliminar")}finally{this.loading=!1}})}}},H={class:"row items-center q-gutter-sm q-mb-md"},S={class:"ellipsis"},B={key:0},z={class:"text-caption text-grey-7"},L={key:1},R={key:0},G={key:0,class:"text-caption text-grey-7"},K={key:1},X={key:0},j={class:"text-subtitle1 text-weight-bold"},J={class:"row q-col-gutter-sm"},W={class:"col-12 col-md-6"},Y={class:"row q-col-gutter-xs q-mt-xs"},Z={class:"col-6"},$={class:"col-6"},ee={class:"col-12 col-md-6"},ae={class:"row q-col-gutter-xs q-mt-sm"},oe={class:"col-6"},le={class:"col-6"},ie={class:"row q-col-gutter-xs q-mt-xs"},te={class:"col-6"},se={class:"col-6"};function re(t,e,ne,de,o,s){return m(),T(I,{class:"q-pa-md bg-grey-2"},{default:r(()=>[i(h,{flat:"",bordered:"",class:"q-pa-md"},{default:r(()=>[l("div",H,[e[19]||(e[19]=l("div",{class:"col-auto"},[l("div",{class:"text-h6 text-weight-bold"},"Tareas y planificación"),l("div",{class:"text-caption text-grey-7"}," Gestiona tus tareas, tiempos estimados, descansos y planificación de estudio. ")],-1)),i(_),i(p,{modelValue:o.filtroMateriaId,"onUpdate:modelValue":[e[0]||(e[0]=a=>o.filtroMateriaId=a),s.listar],options:o.materias,"emit-value":"","map-options":"","option-value":"id","option-label":"label",dense:"",outlined:"",clearable:"",style:{"min-width":"220px"},placeholder:"Filtrar por materia"},null,8,["modelValue","options","onUpdate:modelValue"]),i(p,{modelValue:o.filtroEstado,"onUpdate:modelValue":[e[1]||(e[1]=a=>o.filtroEstado=a),s.listar],options:o.estadoOptions,dense:"",outlined:"",clearable:"",style:{"min-width":"180px"},placeholder:"Estado"},null,8,["modelValue","options","onUpdate:modelValue"]),i(d,{modelValue:o.filtro,"onUpdate:modelValue":e[2]||(e[2]=a=>o.filtro=a),dense:"",outlined:"",placeholder:"Buscar... (tipo, descripción, estado)",style:{"min-width":"260px"},onKeyup:k(s.listar,["enter"])},{append:r(()=>[i(N,{name:"search",class:"cursor-pointer",onClick:s.listar},null,8,["onClick"])]),_:1},8,["modelValue","onKeyup"]),i(u,{color:"primary","no-caps":"",icon:"refresh",label:"Actualizar",loading:o.loading,onClick:s.listar},null,8,["loading","onClick"]),i(u,{color:"positive","no-caps":"",icon:"add_circle_outline",label:"Nueva tarea",loading:o.loading,onClick:s.nuevo},null,8,["loading","onClick"])]),i(M,{modelValue:o.vista,"onUpdate:modelValue":e[3]||(e[3]=a=>o.vista=a),dense:"","active-color":"primary","indicator-color":"primary",align:"left",class:"q-mb-sm"},{default:r(()=>[i(V,{name:"general",label:"Listado general",icon:"list_alt"}),i(V,{name:"prioritaria",label:"Tareas prioritarias",icon:"priority_high"})]),_:1},8,["modelValue"]),i(D,{flat:"",bordered:"",dense:"","wrap-cells":"",class:"bg-white"},{default:r(()=>[e[23]||(e[23]=l("thead",null,[l("tr",null,[l("th",{class:"text-left"},"Acciones"),l("th",{class:"text-left"},"ID"),l("th",{class:"text-left"},"Materia"),l("th",{class:"text-left"},"Tipo"),l("th",{class:"text-left"},"Prioridad"),l("th",{class:"text-left"},"Descripción"),l("th",{class:"text-left"},"Tiempo estimado"),l("th",{class:"text-left"},"Planificación"),l("th",{class:"text-left"},"F. creación"),l("th",{class:"text-left"},"F. entrega"),l("th",{class:"text-left"},"Estado")])],-1)),l("tbody",null,[(m(!0),c(C,null,Q(s.tareasFiltradas,a=>(m(),c("tr",{key:a.id},[l("td",null,[i(u,{size:"sm",dense:"",color:"primary",icon:"edit",flat:"",round:"",onClick:v=>s.editar(a)},{default:r(()=>[i(x,null,{default:r(()=>[...e[20]||(e[20]=[f("Editar",-1)])]),_:1})]),_:1},8,["onClick"]),i(u,{size:"sm",dense:"",color:"negative",icon:"delete",flat:"",round:"",onClick:v=>s.eliminar(a.id)},{default:r(()=>[i(x,null,{default:r(()=>[...e[21]||(e[21]=[f("Eliminar",-1)])]),_:1})]),_:1},8,["onClick"])]),l("td",null,n(a.id),1),l("td",null,n(a.materia?.nombre||"—"),1),l("td",null,n(a.tipo_tarea||"—"),1),l("td",null,[i(y,{dense:"",label:a.prioridad||"Normal",color:s.colorPrioridad(a.prioridad),"text-color":"white"},null,8,["label","color"])]),l("td",S,n(a.descripcion||"—"),1),l("td",null,[a.tiempo_estimado?(m(),c("div",B,[f(n(a.tiempo_estimado)+" min ",1),l("div",z,n(a.descanso_duracion||10)+" min descanso c/ "+n(a.descanso_cada||50),1)])):(m(),c("span",L,"—"))]),l("td",null,[a.fecha_planificada?(m(),c("div",R,[f(n(a.fecha_planificada)+" ",1),a.hora_inicio_plan&&a.hora_fin_plan?(m(),c("div",G,n(a.hora_inicio_plan)+" - "+n(a.hora_fin_plan),1)):g("",!0)])):(m(),c("span",K,"—"))]),l("td",null,n(a.fecha_creacion||"—"),1),l("td",null,n(a.fecha_entrega||"—"),1),l("td",null,[i(y,{dense:"",label:a.estado||"—",color:s.colorEstado(a.estado),"text-color":"white"},null,8,["label","color"])])]))),128)),s.tareasFiltradas.length?g("",!0):(m(),c("tr",X,[...e[22]||(e[22]=[l("td",{colspan:"11",class:"text-center text-grey"}," No hay tareas para los filtros seleccionados. ",-1)])]))])]),_:1})]),_:1}),i(q,{modelValue:o.dialog,"onUpdate:modelValue":e[18]||(e[18]=a=>o.dialog=a),persistent:"",onHide:s.onDialogHide},{default:r(()=>[i(h,{style:{width:"620px","max-width":"95vw"}},{default:r(()=>[i(b,{class:"row items-center q-pb-none"},{default:r(()=>[l("div",j,n(o.form.id?"Editar tarea":"Nueva tarea"),1),i(_),U(i(u,{icon:"close",flat:"",round:"",dense:""},null,512),[[F]])]),_:1}),i(b,{class:"q-pt-sm"},{default:r(()=>[i(P,{onSubmit:A(s.guardar,["prevent"])},{default:r(()=>[l("div",J,[l("div",W,[i(p,{modelValue:o.form.materia_id,"onUpdate:modelValue":e[4]||(e[4]=a=>o.form.materia_id=a),options:o.materias,"emit-value":"","map-options":"","option-value":"id","option-label":"nombre",dense:"",outlined:"",label:"Materia",clearable:""},null,8,["modelValue","options"]),i(p,{modelValue:o.form.tipo_tarea,"onUpdate:modelValue":e[5]||(e[5]=a=>o.form.tipo_tarea=a),options:o.tipoTareaOptions,dense:"",outlined:"",label:"Tipo de tarea",class:"q-mt-sm",clearable:""},null,8,["modelValue","options"]),i(p,{modelValue:o.form.prioridad,"onUpdate:modelValue":e[6]||(e[6]=a=>o.form.prioridad=a),options:o.prioridadOptions,dense:"",outlined:"",label:"Prioridad",class:"q-mt-sm"},null,8,["modelValue","options"]),i(d,{modelValue:o.form.tiempo_estimado,"onUpdate:modelValue":e[7]||(e[7]=a=>o.form.tiempo_estimado=a),modelModifiers:{number:!0},type:"number",min:"0",dense:"",outlined:"",label:"Tiempo estimado (minutos)",class:"q-mt-sm"},null,8,["modelValue"]),l("div",Y,[l("div",Z,[i(d,{modelValue:o.form.descanso_duracion,"onUpdate:modelValue":e[8]||(e[8]=a=>o.form.descanso_duracion=a),modelModifiers:{number:!0},type:"number",min:"0",dense:"",outlined:"",label:"Descanso (min)"},null,8,["modelValue"])]),l("div",$,[i(d,{modelValue:o.form.descanso_cada,"onUpdate:modelValue":e[9]||(e[9]=a=>o.form.descanso_cada=a),modelModifiers:{number:!0},type:"number",min:"0",dense:"",outlined:"",label:"Cada (min de estudio)"},null,8,["modelValue"])])]),e[24]||(e[24]=l("div",{class:"text-caption text-grey-7 q-mt-xs"}," Por defecto 10 min de descanso cada 50 min de estudio. ",-1))]),l("div",ee,[i(d,{modelValue:o.form.descripcion,"onUpdate:modelValue":e[10]||(e[10]=a=>o.form.descripcion=a),type:"textarea",autogrow:"",dense:"",outlined:"",label:"Descripción"},null,8,["modelValue"]),l("div",ae,[l("div",oe,[i(d,{modelValue:o.form.fecha_creacion,"onUpdate:modelValue":e[11]||(e[11]=a=>o.form.fecha_creacion=a),type:"date",dense:"",outlined:"",label:"Fecha de creación"},null,8,["modelValue"])]),l("div",le,[i(d,{modelValue:o.form.fecha_entrega,"onUpdate:modelValue":e[12]||(e[12]=a=>o.form.fecha_entrega=a),type:"date",dense:"",outlined:"",label:"Fecha de entrega"},null,8,["modelValue"])])]),e[25]||(e[25]=l("div",{class:"q-mt-sm text-subtitle2 text-weight-medium"}," Planificación de estudio ",-1)),i(d,{modelValue:o.form.fecha_planificada,"onUpdate:modelValue":e[13]||(e[13]=a=>o.form.fecha_planificada=a),type:"date",dense:"",outlined:"",label:"Fecha planificada",class:"q-mt-xs"},null,8,["modelValue"]),l("div",ie,[l("div",te,[i(d,{modelValue:o.form.hora_inicio_plan,"onUpdate:modelValue":e[14]||(e[14]=a=>o.form.hora_inicio_plan=a),dense:"",outlined:"",label:"Hora inicio",mask:"##:##",hint:"HH:MM"},null,8,["modelValue"])]),l("div",se,[i(d,{modelValue:o.form.hora_fin_plan,"onUpdate:modelValue":e[15]||(e[15]=a=>o.form.hora_fin_plan=a),dense:"",outlined:"",label:"Hora fin",mask:"##:##",hint:"HH:MM"},null,8,["modelValue"])])]),i(p,{modelValue:o.form.estado,"onUpdate:modelValue":e[16]||(e[16]=a=>o.form.estado=a),options:o.estadoOptions,dense:"",outlined:"",label:"Estado",class:"q-mt-sm"},null,8,["modelValue","options"])])])]),_:1},8,["onSubmit"])]),_:1}),i(w,{align:"right"},{default:r(()=>[i(u,{flat:"",color:"negative","no-caps":"",label:"Cancelar",disable:o.loading,onClick:e[17]||(e[17]=a=>o.dialog=!1)},null,8,["disable"]),i(u,{color:"primary","no-caps":"",label:o.form.id?"Actualizar":"Guardar",loading:o.loading,onClick:s.guardar},null,8,["label","loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue","onHide"])]),_:1})}const ve=E(O,[["render",re]]);export{ve as default};
