import{_ as V,c as f,o as n,w as s,b as a,a as e,f as d,a6 as u,a7 as w,d as p,a8 as g,a0 as D,a9 as N,aa as q,X as h,$ as _,a2 as y,t as c,h as B,Q as E,e as k,ab as S,ac as I}from"./index-C6vICkOl.js";import{Q}from"./QSpace-6gsiIia1.js";import{Q as x,a as m,b as C,C as b}from"./ClosePopup-Bgt5Ia8Q.js";import{Q as M,a as U}from"./QList-BWfyn0Vz.js";import{Q as z,a as A}from"./QForm-CXx0LmRg.js";import{Q as H}from"./QPage-c3qQwDhl.js";const K={name:"MateriasPage",data(){return{materias:[],filtro:"",loading:!1,dialog:!1,form:{id:null,nombre:"",docente:"",descripcion:""}}},mounted(){this.listar()},methods:{async listar(){this.loading=!0;try{const o=await this.$axios.get("materias",{params:{q:this.filtro||void 0}});this.materias=o.data}catch(o){this.$alert?.error?.(o.response?.data?.message||"Error al cargar materias")}finally{this.loading=!1}},nuevo(){this.form={id:null,nombre:"",docente:"",descripcion:""},this.dialog=!0},editar(o){this.form={...o,docente:o.docente||"",descripcion:o.descripcion||""},this.dialog=!0},onDialogHide(){this.form={id:null,nombre:"",docente:"",descripcion:""}},async guardar(){this.loading=!0;try{this.form.id?(await this.$axios.put(`materias/${this.form.id}`,this.form),this.$alert?.success?.("Materia actualizada")):(await this.$axios.post("materias",this.form),this.$alert?.success?.("Materia creada")),this.dialog=!1,this.listar()}catch(o){this.$alert?.error?.(o.response?.data?.message||"No se pudo guardar")}finally{this.loading=!1}},eliminar(o){this.$alert?.dialog?.("¿Eliminar registro?")?.onOk(async()=>{this.loading=!0;try{await this.$axios.delete(`materias/${o}`),this.$alert?.success?.("Eliminado"),this.listar()}catch(l){this.$alert?.error?.(l.response?.data?.message||"No se pudo eliminar")}finally{this.loading=!1}})}}},L={class:"row items-center q-gutter-sm q-mb-md"},P={class:"ellipsis"},F={key:0},O={class:"text-subtitle1"},T={class:"row q-col-gutter-sm"},G={class:"col-12 col-sm-6"},R={class:"col-12 col-sm-6"},X={class:"col-12"};function j(o,l,J,W,t,r){return n(),f(H,{class:"q-pa-md"},{default:s(()=>[a("div",L,[e(d,{color:"positive","no-caps":"",icon:"add_circle_outline",label:"Nuevo",onClick:r.nuevo,loading:t.loading},null,8,["onClick","loading"]),e(d,{color:"primary","no-caps":"",icon:"refresh",label:"Actualizar",onClick:r.listar,loading:t.loading},null,8,["onClick","loading"]),e(Q),e(u,{modelValue:t.filtro,"onUpdate:modelValue":l[0]||(l[0]=i=>t.filtro=i),dense:"",outlined:"",placeholder:"Buscar... (nombre, docente, descripción)",onKeyup:w(r.listar,["enter"]),style:{"min-width":"260px"}},{append:s(()=>[e(p,{name:"search",onClick:r.listar,class:"cursor-pointer"},null,8,["onClick"])]),_:1},8,["modelValue","onKeyup"])]),e(z,{flat:"",bordered:"",dense:"","wrap-cells":""},{default:s(()=>[l[9]||(l[9]=a("thead",null,[a("tr",null,[a("th",{class:"text-left"},"Acciones"),a("th",{class:"text-left"},"ID"),a("th",{class:"text-left"},"Nombre"),a("th",{class:"text-left"},"Docente"),a("th",{class:"text-left"},"Descripción")])],-1)),a("tbody",null,[(n(!0),g(N,null,q(t.materias,i=>(n(),g("tr",{key:i.id},[a("td",null,[e(M,{label:"Opciones",size:"sm",dense:"",color:"primary","no-caps":""},{default:s(()=>[e(U,null,{default:s(()=>[h((n(),f(x,{clickable:"",onClick:v=>r.editar(i)},{default:s(()=>[e(m,{avatar:""},{default:s(()=>[e(p,{name:"edit"})]),_:1}),e(m,null,{default:s(()=>[e(C,null,{default:s(()=>[...l[6]||(l[6]=[_("Editar",-1)])]),_:1})]),_:1})]),_:1},8,["onClick"])),[[y],[b]]),h((n(),f(x,{clickable:"",onClick:v=>r.eliminar(i.id)},{default:s(()=>[e(m,{avatar:""},{default:s(()=>[e(p,{name:"delete"})]),_:1}),e(m,null,{default:s(()=>[e(C,null,{default:s(()=>[...l[7]||(l[7]=[_("Eliminar",-1)])]),_:1})]),_:1})]),_:1},8,["onClick"])),[[y],[b]])]),_:2},1024)]),_:2},1024)]),a("td",null,c(i.id),1),a("td",null,c(i.nombre||"—"),1),a("td",null,c(i.docente||"—"),1),a("td",P,c(i.descripcion||"—"),1)]))),128)),t.materias.length?D("",!0):(n(),g("tr",F,[...l[8]||(l[8]=[a("td",{colspan:"6",class:"text-center text-grey"},"Sin datos",-1)])]))])]),_:1}),e(B,{modelValue:t.dialog,"onUpdate:modelValue":l[5]||(l[5]=i=>t.dialog=i),persistent:"",onHide:r.onDialogHide},{default:s(()=>[e(E,{style:{width:"520px","max-width":"92vw"}},{default:s(()=>[e(k,{class:"row items-center q-pb-none"},{default:s(()=>[a("div",O,c(t.form.id?"Editar materia":"Nueva materia"),1),e(Q),h(e(d,{icon:"close",flat:"",round:"",dense:""},null,512),[[b]])]),_:1}),e(k,{class:"q-pt-sm"},{default:s(()=>[e(A,{onSubmit:S(r.guardar,["prevent"])},{default:s(()=>[a("div",T,[a("div",G,[e(u,{modelValue:t.form.nombre,"onUpdate:modelValue":l[1]||(l[1]=i=>t.form.nombre=i),dense:"",outlined:"",label:"Nombre"},null,8,["modelValue"])]),a("div",R,[e(u,{modelValue:t.form.docente,"onUpdate:modelValue":l[2]||(l[2]=i=>t.form.docente=i),dense:"",outlined:"",label:"Docente"},null,8,["modelValue"])]),a("div",X,[e(u,{modelValue:t.form.descripcion,"onUpdate:modelValue":l[3]||(l[3]=i=>t.form.descripcion=i),type:"textarea",autogrow:"",dense:"",outlined:"",label:"Descripción"},null,8,["modelValue"])])])]),_:1},8,["onSubmit"])]),_:1}),e(I,{align:"right"},{default:s(()=>[e(d,{flat:"",color:"negative","no-caps":"",label:"Cancelar",onClick:l[4]||(l[4]=i=>t.dialog=!1),disable:t.loading},null,8,["disable"]),e(d,{color:"primary","no-caps":"",label:t.form.id?"Actualizar":"Guardar",onClick:r.guardar,loading:t.loading},null,8,["label","onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue","onHide"])]),_:1})}const te=V(K,[["render",j]]);export{te as default};
