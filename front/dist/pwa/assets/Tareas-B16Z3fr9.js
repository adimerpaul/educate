import{Q as U}from"./QSpace-Bxp2NexB.js";import{b as _,Q as ve,a as D}from"./QSelect-RDl2IYP1.js";import{j as be,ae as S,L as ye,ai as xe,O as Ve,g as Te,r as H,k as E,aj as Ee,R as ke,ak as Ce,S as we,al as Pe,v as I,x as F,A as L,F as B,am as Se,l as R,an as Ae,n as Ne,K as qe,_ as Oe,c as Me,o as f,w as n,a as i,Q as j,b as l,a7 as u,ab as Qe,d as Ue,f as g,a6 as p,a0 as z,a8 as De,a9 as He,$ as k,t as d,h as Ie,e as G,X as Fe,ad as Le,aa as Be}from"./index-Df8BWSg2.js";import{v as Re,e as K,u as je,p as W,f as ze,g as Ge,h as Ke,r as X,s as We,c as J}from"./QMenu-C-9qBbnL.js";import{Q as Y}from"./QChip-CMRcTm-s.js";import{Q as Xe}from"./QMarkupTable-D_NXUQml.js";import{Q as Je}from"./QForm-DaFIjbRg.js";import{Q as Ye}from"./QPage-BlBGdOzc.js";import{C as Ze}from"./ClosePopup-S1YJxfSL.js";import"./QResizeObserver-D5xsHC2a.js";import"./format-BvkBI9bc.js";const Z=be({name:"QTooltip",inheritAttrs:!1,props:{...je,...Ve,...S,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null},transitionShow:{...S.transitionShow,default:"jump-down"},transitionHide:{...S.transitionHide,default:"jump-up"},anchor:{type:String,default:"bottom middle",validator:K},self:{type:String,default:"top middle",validator:K},offset:{type:Array,default:()=>[14,14],validator:Re},scrollTarget:xe,delay:{type:Number,default:0},hideDelay:{type:Number,default:0},persistent:Boolean},emits:[...ye],setup(t,{slots:e,emit:C,attrs:x}){let o,s;const a=Te(),{proxy:{$q:c}}=a,v=H(null),V=H(!1),$=E(()=>W(t.anchor,c.lang.rtl)),ee=E(()=>W(t.self,c.lang.rtl)),ae=E(()=>t.persistent!==!0),{registerTick:te,removeTick:oe}=Ee(),{registerTimeout:T}=ke(),{transitionProps:le,transitionStyle:ie}=Ce(t),{localScrollTarget:A,changeScrollEvent:se,unconfigureScrollTarget:ne}=ze(t,M),{anchorEl:m,canShow:re,anchorEvents:b}=Ge({showing:V,configureAnchorEl:he}),{show:de,hide:w}=we({showing:V,canShow:re,handleShow:ue,handleHide:me,hideOnRouteChange:ae,processOnMount:!0});Object.assign(b,{delayShow:fe,delayHide:pe});const{showPortal:N,hidePortal:q,renderPortal:ce}=Pe(a,v,_e,"tooltip");if(c.platform.is.mobile===!0){const r={anchorEl:m,innerRef:v,onClickOutside(h){return w(h),h.target.classList.contains("q-dialog__backdrop")&&qe(h),!0}},P=E(()=>t.modelValue===null&&t.persistent!==!0&&V.value===!0);I(P,h=>{(h===!0?Ke:X)(r)}),F(()=>{X(r)})}function ue(r){N(),te(()=>{s=new MutationObserver(()=>y()),s.observe(v.value,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),y(),M()}),o===void 0&&(o=I(()=>c.screen.width+"|"+c.screen.height+"|"+t.self+"|"+t.anchor+"|"+c.lang.rtl,y)),T(()=>{N(!0),C("show",r)},t.transitionDuration)}function me(r){oe(),q(),O(),T(()=>{q(!0),C("hide",r)},t.transitionDuration)}function O(){s!==void 0&&(s.disconnect(),s=void 0),o!==void 0&&(o(),o=void 0),ne(),L(b,"tooltipTemp")}function y(){We({targetEl:v.value,offset:t.offset,anchorEl:m.value,anchorOrigin:$.value,selfOrigin:ee.value,maxHeight:t.maxHeight,maxWidth:t.maxWidth})}function fe(r){if(c.platform.is.mobile===!0){J(),document.body.classList.add("non-selectable");const P=m.value,h=["touchmove","touchcancel","touchend","click"].map(Q=>[P,Q,"delayHide","passiveCapture"]);B(b,"tooltipTemp",h)}T(()=>{de(r)},t.delay)}function pe(r){c.platform.is.mobile===!0&&(L(b,"tooltipTemp"),J(),setTimeout(()=>{document.body.classList.remove("non-selectable")},10)),T(()=>{w(r)},t.hideDelay)}function he(){if(t.noParentEvent===!0||m.value===null)return;const r=c.platform.is.mobile===!0?[[m.value,"touchstart","delayShow","passive"]]:[[m.value,"mouseenter","delayShow","passive"],[m.value,"mouseleave","delayHide","passive"]];B(b,"anchor",r)}function M(){if(m.value!==null||t.scrollTarget!==void 0){A.value=Se(m.value,t.scrollTarget);const r=t.noParentEvent===!0?y:w;se(A.value,r)}}function ge(){return V.value===!0?R("div",{...x,ref:v,class:["q-tooltip q-tooltip--style q-position-engine no-pointer-events",x.class],style:[x.style,ie.value],role:"tooltip"},Ne(e.default)):null}function _e(){return R(Ae,le.value,ge)}return F(O),Object.assign(a.proxy,{updatePosition:y}),ce}}),$e={name:"TareasPage",data(){return{tareas:[],materias:[],filtro:"",filtroMateriaId:null,filtroEstado:null,vista:"general",loading:!1,dialog:!1,form:{id:null,materia_id:null,tipo_tarea:"",descripcion:"",fecha_entrega:"",fecha_creacion:"",estado:"",tiempo_estimado:null,prioridad:"Normal",fecha_planificada:"",hora_inicio_plan:"",hora_fin_plan:"",descanso_duracion:10,descanso_cada:50},tipoTareaOptions:["Normal","Estudio","Examen"],prioridadOptions:["Normal","Alta"],estadoOptions:["PENDIENTE","ENTREGADA","ATRASADA"]}},computed:{materiaOptions(){return(this.materias||[]).map(t=>({id:t.id,label:t.nombre}))},tareasFiltradas(){const t=this.tareas||[];return this.vista==="prioritaria"?t.filter(e=>(e.prioridad||"").toUpperCase()==="ALTA"):t}},mounted(){this.cargarMaterias(),this.listar()},methods:{colorEstado(t){switch((t||"").toUpperCase()){case"ENTREGADA":return"positive";case"ATRASADA":return"negative";case"PENDIENTE":return"warning";default:return"grey-7"}},colorPrioridad(t){return(t||"NORMAL").toUpperCase()==="ALTA"?"deep-orange":"grey-7"},async cargarMaterias(){try{const t=await this.$axios.get("materias");this.materias=(t.data||[]).map(e=>({...e,label:e.nombre}))}catch(t){this.$alert?.error?.(t.response?.data?.message||"Error cargando materias")}},async listar(){this.loading=!0;try{const t={q:this.filtro||void 0,materia_id:this.filtroMateriaId||void 0,estado:this.filtroEstado||void 0},e=await this.$axios.get("tareas",{params:t});this.tareas=e.data}catch(t){this.$alert?.error?.(t.response?.data?.message||"Error al cargar tareas")}finally{this.loading=!1}},nuevo(){this.form={id:null,materia_id:this.filtroMateriaId||null,tipo_tarea:"",descripcion:"",fecha_entrega:"",fecha_creacion:new Date().toISOString().slice(0,10),estado:this.filtroEstado||"PENDIENTE",tiempo_estimado:null,prioridad:"Normal",fecha_planificada:"",hora_inicio_plan:"",hora_fin_plan:"",descanso_duracion:10,descanso_cada:50},this.dialog=!0},editar(t){this.form={id:t.id,materia_id:t.materia_id??t.materia?.id??null,tipo_tarea:t.tipo_tarea||"",descripcion:t.descripcion||"",fecha_entrega:t.fecha_entrega||"",fecha_creacion:t.fecha_creacion||"",estado:t.estado||"PENDIENTE",tiempo_estimado:t.tiempo_estimado??null,prioridad:t.prioridad||"Normal",fecha_planificada:t.fecha_planificada||"",hora_inicio_plan:t.hora_inicio_plan||"",hora_fin_plan:t.hora_fin_plan||"",descanso_duracion:t.descanso_duracion??10,descanso_cada:t.descanso_cada??50},this.dialog=!0},onDialogHide(){this.form={id:null,materia_id:null,tipo_tarea:"",descripcion:"",fecha_entrega:"",fecha_creacion:"",estado:"",tiempo_estimado:null,prioridad:"Normal",fecha_planificada:"",hora_inicio_plan:"",hora_fin_plan:"",descanso_duracion:10,descanso_cada:50}},async guardar(){this.loading=!0;try{this.form.id?(await this.$axios.put(`tareas/${this.form.id}`,this.form),this.$alert?.success?.("Tarea actualizada correctamente")):(await this.$axios.post("tareas",this.form),this.$alert?.success?.("Tarea creada correctamente")),this.dialog=!1,this.listar()}catch(t){this.$alert?.error?.(t.response?.data?.message||"No se pudo guardar la tarea")}finally{this.loading=!1}},eliminar(t){this.$alert?.dialog?.("¿Eliminar esta tarea?")?.onOk(async()=>{this.loading=!0;try{await this.$axios.delete(`tareas/${t}`),this.$alert?.success?.("Tarea eliminada"),this.listar()}catch(e){this.$alert?.error?.(e.response?.data?.message||"No se pudo eliminar")}finally{this.loading=!1}})}}},ea={class:"row items-center q-gutter-sm q-mb-md"},aa={class:"ellipsis"},ta={key:0},oa={class:"text-caption text-grey-7"},la={key:1},ia={key:0},sa={key:0,class:"text-caption text-grey-7"},na={key:1},ra={key:0},da={class:"text-subtitle1 text-weight-bold"},ca={class:"row q-col-gutter-sm"},ua={class:"col-12 col-md-6"},ma={class:"row q-col-gutter-xs q-mt-xs"},fa={class:"col-6"},pa={class:"col-6"},ha={class:"col-12 col-md-6"},ga={class:"row q-col-gutter-xs q-mt-sm"},_a={class:"col-6"},va={class:"col-6"},ba={class:"row q-col-gutter-xs q-mt-xs"},ya={class:"col-6"},xa={class:"col-6"};function Va(t,e,C,x,o,s){return f(),Me(Ye,{class:"q-pa-md bg-grey-2"},{default:n(()=>[i(j,{flat:"",bordered:"",class:"q-pa-md"},{default:n(()=>[l("div",ea,[e[19]||(e[19]=l("div",{class:"col-auto"},[l("div",{class:"text-h6 text-weight-bold"},"Tareas y planificación"),l("div",{class:"text-caption text-grey-7"}," Gestiona tus tareas, tiempos estimados, descansos y planificación de estudio. ")],-1)),i(U),i(_,{modelValue:o.filtroMateriaId,"onUpdate:modelValue":[e[0]||(e[0]=a=>o.filtroMateriaId=a),s.listar],options:o.materias,"emit-value":"","map-options":"","option-value":"id","option-label":"label",dense:"",outlined:"",clearable:"",style:{"min-width":"220px"},placeholder:"Filtrar por materia"},null,8,["modelValue","options","onUpdate:modelValue"]),i(_,{modelValue:o.filtroEstado,"onUpdate:modelValue":[e[1]||(e[1]=a=>o.filtroEstado=a),s.listar],options:o.estadoOptions,dense:"",outlined:"",clearable:"",style:{"min-width":"180px"},placeholder:"Estado"},null,8,["modelValue","options","onUpdate:modelValue"]),i(u,{modelValue:o.filtro,"onUpdate:modelValue":e[2]||(e[2]=a=>o.filtro=a),dense:"",outlined:"",placeholder:"Buscar... (tipo, descripción, estado)",style:{"min-width":"260px"},onKeyup:Qe(s.listar,["enter"])},{append:n(()=>[i(Ue,{name:"search",class:"cursor-pointer",onClick:s.listar},null,8,["onClick"])]),_:1},8,["modelValue","onKeyup"]),i(g,{color:"primary","no-caps":"",icon:"refresh",label:"Actualizar",loading:o.loading,onClick:s.listar},null,8,["loading","onClick"]),i(g,{color:"positive","no-caps":"",icon:"add_circle_outline",label:"Nueva tarea",loading:o.loading,onClick:s.nuevo},null,8,["loading","onClick"])]),i(ve,{modelValue:o.vista,"onUpdate:modelValue":e[3]||(e[3]=a=>o.vista=a),dense:"","active-color":"primary","indicator-color":"primary",align:"left",class:"q-mb-sm"},{default:n(()=>[i(D,{name:"general",label:"Listado general",icon:"list_alt"}),i(D,{name:"prioritaria",label:"Tareas prioritarias",icon:"priority_high"})]),_:1},8,["modelValue"]),i(Xe,{flat:"",bordered:"",dense:"","wrap-cells":"",class:"bg-white"},{default:n(()=>[e[23]||(e[23]=l("thead",null,[l("tr",null,[l("th",{class:"text-left"},"Acciones"),l("th",{class:"text-left"},"ID"),l("th",{class:"text-left"},"Materia"),l("th",{class:"text-left"},"Tipo"),l("th",{class:"text-left"},"Prioridad"),l("th",{class:"text-left"},"Descripción"),l("th",{class:"text-left"},"Tiempo estimado"),l("th",{class:"text-left"},"Planificación"),l("th",{class:"text-left"},"F. creación"),l("th",{class:"text-left"},"F. entrega"),l("th",{class:"text-left"},"Estado")])],-1)),l("tbody",null,[(f(!0),p(De,null,He(s.tareasFiltradas,a=>(f(),p("tr",{key:a.id},[l("td",null,[i(g,{size:"sm",dense:"",color:"primary",icon:"edit",flat:"",round:"",onClick:c=>s.editar(a)},{default:n(()=>[i(Z,null,{default:n(()=>[...e[20]||(e[20]=[k("Editar",-1)])]),_:1})]),_:1},8,["onClick"]),i(g,{size:"sm",dense:"",color:"negative",icon:"delete",flat:"",round:"",onClick:c=>s.eliminar(a.id)},{default:n(()=>[i(Z,null,{default:n(()=>[...e[21]||(e[21]=[k("Eliminar",-1)])]),_:1})]),_:1},8,["onClick"])]),l("td",null,d(a.id),1),l("td",null,d(a.materia?.nombre||"—"),1),l("td",null,d(a.tipo_tarea||"—"),1),l("td",null,[i(Y,{dense:"",label:a.prioridad||"Normal",color:s.colorPrioridad(a.prioridad),"text-color":"white"},null,8,["label","color"])]),l("td",aa,d(a.descripcion||"—"),1),l("td",null,[a.tiempo_estimado?(f(),p("div",ta,[k(d(a.tiempo_estimado)+" min ",1),l("div",oa,d(a.descanso_duracion||10)+" min descanso c/ "+d(a.descanso_cada||50),1)])):(f(),p("span",la,"—"))]),l("td",null,[a.fecha_planificada?(f(),p("div",ia,[k(d(a.fecha_planificada)+" ",1),a.hora_inicio_plan&&a.hora_fin_plan?(f(),p("div",sa,d(a.hora_inicio_plan)+" - "+d(a.hora_fin_plan),1)):z("",!0)])):(f(),p("span",na,"—"))]),l("td",null,d(a.fecha_creacion||"—"),1),l("td",null,d(a.fecha_entrega||"—"),1),l("td",null,[i(Y,{dense:"",label:a.estado||"—",color:s.colorEstado(a.estado),"text-color":"white"},null,8,["label","color"])])]))),128)),s.tareasFiltradas.length?z("",!0):(f(),p("tr",ra,[...e[22]||(e[22]=[l("td",{colspan:"11",class:"text-center text-grey"}," No hay tareas para los filtros seleccionados. ",-1)])]))])]),_:1})]),_:1}),i(Ie,{modelValue:o.dialog,"onUpdate:modelValue":e[18]||(e[18]=a=>o.dialog=a),persistent:"",onHide:s.onDialogHide},{default:n(()=>[i(j,{style:{width:"620px","max-width":"95vw"}},{default:n(()=>[i(G,{class:"row items-center q-pb-none"},{default:n(()=>[l("div",da,d(o.form.id?"Editar tarea":"Nueva tarea"),1),i(U),Fe(i(g,{icon:"close",flat:"",round:"",dense:""},null,512),[[Ze]])]),_:1}),i(G,{class:"q-pt-sm"},{default:n(()=>[i(Je,{onSubmit:Le(s.guardar,["prevent"])},{default:n(()=>[l("div",ca,[l("div",ua,[i(_,{modelValue:o.form.materia_id,"onUpdate:modelValue":e[4]||(e[4]=a=>o.form.materia_id=a),options:o.materias,"emit-value":"","map-options":"","option-value":"id","option-label":"nombre",dense:"",outlined:"",label:"Materia",clearable:""},null,8,["modelValue","options"]),i(_,{modelValue:o.form.tipo_tarea,"onUpdate:modelValue":e[5]||(e[5]=a=>o.form.tipo_tarea=a),options:o.tipoTareaOptions,dense:"",outlined:"",label:"Tipo de tarea",class:"q-mt-sm",clearable:""},null,8,["modelValue","options"]),i(_,{modelValue:o.form.prioridad,"onUpdate:modelValue":e[6]||(e[6]=a=>o.form.prioridad=a),options:o.prioridadOptions,dense:"",outlined:"",label:"Prioridad",class:"q-mt-sm"},null,8,["modelValue","options"]),i(u,{modelValue:o.form.tiempo_estimado,"onUpdate:modelValue":e[7]||(e[7]=a=>o.form.tiempo_estimado=a),modelModifiers:{number:!0},type:"number",min:"0",dense:"",outlined:"",label:"Tiempo estimado (minutos)",class:"q-mt-sm"},null,8,["modelValue"]),l("div",ma,[l("div",fa,[i(u,{modelValue:o.form.descanso_duracion,"onUpdate:modelValue":e[8]||(e[8]=a=>o.form.descanso_duracion=a),modelModifiers:{number:!0},type:"number",min:"0",dense:"",outlined:"",label:"Descanso (min)"},null,8,["modelValue"])]),l("div",pa,[i(u,{modelValue:o.form.descanso_cada,"onUpdate:modelValue":e[9]||(e[9]=a=>o.form.descanso_cada=a),modelModifiers:{number:!0},type:"number",min:"0",dense:"",outlined:"",label:"Cada (min de estudio)"},null,8,["modelValue"])])]),e[24]||(e[24]=l("div",{class:"text-caption text-grey-7 q-mt-xs"}," Por defecto 10 min de descanso cada 50 min de estudio. ",-1))]),l("div",ha,[i(u,{modelValue:o.form.descripcion,"onUpdate:modelValue":e[10]||(e[10]=a=>o.form.descripcion=a),type:"textarea",autogrow:"",dense:"",outlined:"",label:"Descripción"},null,8,["modelValue"]),l("div",ga,[l("div",_a,[i(u,{modelValue:o.form.fecha_creacion,"onUpdate:modelValue":e[11]||(e[11]=a=>o.form.fecha_creacion=a),type:"date",dense:"",outlined:"",label:"Fecha de creación"},null,8,["modelValue"])]),l("div",va,[i(u,{modelValue:o.form.fecha_entrega,"onUpdate:modelValue":e[12]||(e[12]=a=>o.form.fecha_entrega=a),type:"date",dense:"",outlined:"",label:"Fecha de entrega"},null,8,["modelValue"])])]),e[25]||(e[25]=l("div",{class:"q-mt-sm text-subtitle2 text-weight-medium"}," Planificación de estudio ",-1)),i(u,{modelValue:o.form.fecha_planificada,"onUpdate:modelValue":e[13]||(e[13]=a=>o.form.fecha_planificada=a),type:"date",dense:"",outlined:"",label:"Fecha planificada",class:"q-mt-xs"},null,8,["modelValue"]),l("div",ba,[l("div",ya,[i(u,{modelValue:o.form.hora_inicio_plan,"onUpdate:modelValue":e[14]||(e[14]=a=>o.form.hora_inicio_plan=a),dense:"",outlined:"",label:"Hora inicio",mask:"##:##",hint:"HH:MM"},null,8,["modelValue"])]),l("div",xa,[i(u,{modelValue:o.form.hora_fin_plan,"onUpdate:modelValue":e[15]||(e[15]=a=>o.form.hora_fin_plan=a),dense:"",outlined:"",label:"Hora fin",mask:"##:##",hint:"HH:MM"},null,8,["modelValue"])])]),i(_,{modelValue:o.form.estado,"onUpdate:modelValue":e[16]||(e[16]=a=>o.form.estado=a),options:o.estadoOptions,dense:"",outlined:"",label:"Estado",class:"q-mt-sm"},null,8,["modelValue","options"])])])]),_:1},8,["onSubmit"])]),_:1}),i(Be,{align:"right"},{default:n(()=>[i(g,{flat:"",color:"negative","no-caps":"",label:"Cancelar",disable:o.loading,onClick:e[17]||(e[17]=a=>o.dialog=!1)},null,8,["disable"]),i(g,{color:"primary","no-caps":"",label:o.form.id?"Actualizar":"Guardar",loading:o.loading,onClick:s.guardar},null,8,["label","loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue","onHide"])]),_:1})}const Ma=Oe($e,[["render",Va]]);export{Ma as default};
